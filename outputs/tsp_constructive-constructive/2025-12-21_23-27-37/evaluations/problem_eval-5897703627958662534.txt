def select_next_node(current_node, destination_node, unvisited_nodes, distance_matrix):
    """
    Selects the next node by evaluating each candidate based on a composite score.
    The score sums three components: the cost to reach the candidate (step 1),
    the average cost from the candidate to all other unvisited nodes (step 2),
    and the cost from the candidate back to the destination. This balances
    immediate cost, regional positioning, and end-of-tour cost.
    """
    next_node = None
    best_score = float('inf')

    if not unvisited_nodes:
        return None

    # If only one unvisited node is left, it's the only choice.
    if len(unvisited_nodes) == 1:
        return list(unvisited_nodes)[0]

    # Iterate through each potential next node to evaluate its score.
    for candidate_node in unvisited_nodes:
        # Cost of the first step (current -> candidate).
        cost_step1 = distance_matrix[current_node][candidate_node]
        
        # Calculate the average cost for the second step (candidate -> all others).
        nodes_for_step2 = unvisited_nodes - {candidate_node}
        sum_of_step2_costs = 0
        
        if nodes_for_step2:
            for next_hop_node in nodes_for_step2:
                sum_of_step2_costs += distance_matrix[candidate_node][next_hop_node]
            avg_cost_step2 = sum_of_step2_costs / len(nodes_for_step2)
        else:
            # No other nodes for step 2, so the average cost is 0.
            avg_cost_step2 = 0
            
        # Cost from the candidate node back to the original destination.
        cost_to_destination = distance_matrix[candidate_node][destination_node]

        # The score for the candidate is the sum of the three cost components.
        # This new equation is the primary change from the original algorithm.
        total_score = cost_step1 + avg_cost_step2 + cost_to_destination
        
        if total_score < best_score:
            best_score = total_score
            next_node = candidate_node
            
    return next_node
